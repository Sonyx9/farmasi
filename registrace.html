<!DOCTYPE html>
<html lang="cs" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Registrace / Kontakt - Farmasi" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <title>Registrace / Kontakt | Farmasi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'farmasi-pink': '#F8E8E8',
            'farmasi-rose': '#E8B4B8',
            'farmasi-gold': '#D4AF37',
            'farmasi-dark': '#2C2C2C',
          },
          fontFamily: {
            'elegant': ['Georgia', 'serif'],
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&family=Montserrat:wght@300;400;500;600&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
    }
    
    h1, h2, h3 {
      font-family: 'Playfair Display', serif;
    }
    
    .gold-accent {
      color: #D4AF37;
    }
    
    .hero-gradient {
      background: linear-gradient(135deg, #FFF5F5 0%, #F8E8E8 100%);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #E8B4B8 0%, #D4A5A9 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover:not(:disabled) {
      background: #D4AF37;
      color: white !important;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
    }
    
    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .form-input {
      transition: all 0.3s ease;
    }
    
    .form-input:focus {
      border-color: #E8B4B8;
      box-shadow: 0 0 0 3px rgba(232, 180, 184, 0.1);
      outline: none;
    }
    
    .error-message {
      color: #dc2626;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }
    
    .success-message {
      color: #16a34a;
      font-size: 0.875rem;
      margin-top: 0.5rem;
      padding: 0.75rem;
      background-color: #f0fdf4;
      border: 1px solid #86efac;
      border-radius: 0.5rem;
    }
    
    .honeypot {
      position: absolute;
      left: -9999px;
      opacity: 0;
      pointer-events: none;
    }
  </style>
</head>
<body class="font-sans text-gray-800 bg-gray-50">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b border-farmasi-pink">
    <nav class="max-w-7xl mx-auto flex items-center justify-between px-4 py-4 lg:px-8">
      <a href="index.html" class="flex flex-col items-start logo-container">
        <img 
          src="https://content.farmasi.com/js/CZ-20260105124805-5a1cba1a-b3cb-41bc-b187-c01bd35b5c60/_next/static/media/logoText.f15a2acb.svg" 
          alt="Farmasi" 
          class="h-5 md:h-6 logo-image"
        />
        <span class="text-gray-500 font-light mt-0.5 logo-tagline" style="font-family: 'Montserrat', sans-serif; text-transform: uppercase;">Freedom fashion</span>
      </a>
      <a href="index.html" class="text-gray-700 hover:text-farmasi-rose transition-colors text-sm font-medium">
        ← Zpět na hlavní stránku
      </a>
    </nav>
  </header>

  <main>
    <!-- Registration Section -->
    <section class="py-8 hero-gradient min-h-screen flex items-center">
      <div class="max-w-2xl mx-auto px-4 w-full">
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8">
          <!-- Header -->
          <div class="text-center mb-6">
            <h1 class="text-2xl md:text-3xl font-bold mb-2 text-farmasi-dark">
              Registrace / <span class="gold-accent">Kontakt</span>
            </h1>
            <p class="text-sm text-gray-600">
              Zanechte nám zprávu a my se vám ozveme
            </p>
          </div>

          <!-- Messages -->
          <div id="form-messages" class="mb-4"></div>

          <form id="contact-form" class="space-y-4" novalidate>
            <!-- Jméno a příjmení -->
            <div>
              <label for="name" class="block text-xs font-medium text-gray-700 mb-1">
                Jméno a příjmení <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="form-input w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-farmasi-rose focus:border-farmasi-rose"
                placeholder="Zadejte jméno a příjmení"
              />
              <div id="name-error" class="error-message"></div>
            </div>

            <!-- Grid: Email a Telefon -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Email -->
              <div>
                <label for="email" class="block text-xs font-medium text-gray-700 mb-1">
                  E-mail
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  class="form-input w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-farmasi-rose focus:border-farmasi-rose"
                  placeholder="vas@email.cz"
                />
                <div id="email-error" class="error-message"></div>
              </div>

              <!-- Telefon -->
              <div>
                <label for="phone" class="block text-xs font-medium text-gray-700 mb-1">
                  Telefon
                </label>
                <div class="flex">
                  <span class="inline-flex items-center px-2 rounded-l-lg border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-xs">
                    +420
                  </span>
                  <input
                    type="tel"
                    id="phone"
                    name="phone"
                    class="form-input flex-1 px-3 py-2 text-sm border border-gray-300 rounded-r-lg focus:ring-2 focus:ring-farmasi-rose focus:border-farmasi-rose"
                    placeholder="776 487 352"
                    pattern="[0-9]{9}"
                  />
                </div>
                <div id="phone-error" class="error-message"></div>
              </div>
            </div>

            <!-- Contact validation message -->
            <div id="contact-error" class="error-message"></div>

            <!-- Zpráva / Poznámka -->
            <div>
              <label for="message" class="block text-xs font-medium text-gray-700 mb-1">
                Zpráva / Poznámka
              </label>
              <textarea
                id="message"
                name="message"
                rows="3"
                class="form-input w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-farmasi-rose focus:border-farmasi-rose resize-none"
                placeholder="Vaše zpráva nebo poznámka (volitelné)"
              ></textarea>
            </div>

            <!-- GDPR Checkbox -->
            <div>
              <label class="flex items-start gap-2 cursor-pointer">
                <input
                  type="checkbox"
                  id="gdpr"
                  name="gdpr"
                  required
                  class="mt-1 w-4 h-4 text-farmasi-rose border-gray-300 rounded focus:ring-farmasi-rose"
                />
                <span class="text-xs text-gray-700">
                  Souhlasím se <a href="#" class="text-farmasi-rose hover:underline">zpracováním osobních údajů</a> <span class="text-red-500">*</span>
                </span>
              </label>
              <div id="gdpr-error" class="error-message"></div>
            </div>

            <!-- Hidden fields -->
            <input type="hidden" id="source" name="source" />
            <input type="text" id="website" name="website" class="honeypot" tabindex="-1" autocomplete="off" />

            <!-- Submit Button -->
            <div class="pt-2">
              <button
                type="submit"
                id="submit-btn"
                class="btn-primary w-full text-white font-semibold px-6 py-3 rounded-lg text-base shadow-lg"
              >
                Odeslat
              </button>
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ============================================
    // CONFIGURATION
    // ============================================
    const CONFIG = {
      SCRIPT_ENDPOINT_URL: 'https://script.google.com/macros/s/AKfycbwr4fxTpuVpX7GD8hEW9IT46rICPmSjKwcV3hzCmrp4pvQaynTEGoms8YVHwFsO2ZQD0w/exec',
      SECRET_TOKEN: '1506-123-12-157489-13589-farmasi'
    };
    // ============================================

    // Set source URL
    document.getElementById('source').value = window.location.href;

    const form = document.getElementById('contact-form');
    const submitBtn = document.getElementById('submit-btn');
    const messagesDiv = document.getElementById('form-messages');
    let isSubmitting = false;

    // Clear error messages
    function clearErrors() {
      document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
      messagesDiv.innerHTML = '';
    }

    // Show error message
    function showError(fieldId, message) {
      const errorEl = document.getElementById(fieldId + '-error');
      if (errorEl) {
        errorEl.textContent = message;
      }
    }

    // Show success/error message
    function showMessage(type, text) {
      messagesDiv.innerHTML = `<div class="${type === 'success' ? 'success-message' : 'error-message'}">${text}</div>`;
      
      if (type === 'success') {
        // Scroll to top
        messagesDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }
    }

    // Validate form
    function validateForm() {
      clearErrors();
      let isValid = true;

      // Name required
      const name = document.getElementById('name').value.trim();
      if (!name) {
        showError('name', 'Jméno a příjmení je povinné');
        isValid = false;
      }

      // Email or phone required (at least one)
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      
      if (!email && !phone) {
        showError('contact', 'Vyplňte prosím alespoň e-mail nebo telefon');
        isValid = false;
      }

      // Email validation if filled
      if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        showError('email', 'Zadejte platnou e-mailovou adresu');
        isValid = false;
      }

      // GDPR required
      const gdpr = document.getElementById('gdpr').checked;
      if (!gdpr) {
        showError('gdpr', 'Musíte souhlasit se zpracováním osobních údajů');
        isValid = false;
      }

      // Honeypot check
      const website = document.getElementById('website').value;
      if (website) {
        isValid = false; // Bot detected, don't submit
      }

      return isValid;
    }

    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Prevent double submit
      if (isSubmitting) {
        return;
      }

      // Validate
      if (!validateForm()) {
        return;
      }

      // Check honeypot
      const website = document.getElementById('website').value;
      if (website) {
        return; // Bot detected, silently fail
      }

      // Disable button and show loading
      isSubmitting = true;
      submitBtn.disabled = true;
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Odesílám…';

      // Prepare data
      const formDataObj = {
        token: CONFIG.SECRET_TOKEN,
        name: document.getElementById('name').value.trim(),
        email: document.getElementById('email').value.trim() || '',
        phone: document.getElementById('phone').value.trim() || '',
        message: document.getElementById('message').value.trim() || '',
        source: document.getElementById('source').value,
        website: ''
      };

      try {
        console.log('Sending data:', formDataObj);
        
        // Pro no-cors musíme poslat data jako JSON string v body
        // Google Apps Script potřebuje správně parsovat postData.contents
        const jsonData = JSON.stringify(formDataObj);
        
        // Zkusíme nejdřív normální fetch (abychom viděli odpověď)
        let response;
        let useNoCors = false;
        
        try {
          response = await fetch(CONFIG.SCRIPT_ENDPOINT_URL, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: jsonData
          });
          
          console.log('Response status:', response.status);
          console.log('Response ok:', response.ok);
          
          // Pokud response není ok, zkusíme přečíst chybu
          if (!response.ok) {
            const errorText = await response.text();
            console.error('Error response:', errorText);
            throw new Error('Server returned error: ' + response.status);
          }
          
          // Přečteme odpověď
          const responseText = await response.text();
          console.log('Response text:', responseText);
          
          let result;
          try {
            result = JSON.parse(responseText);
          } catch (e) {
            // Pokud není JSON, předpokládáme úspěch
            result = { ok: true };
          }
          
          if (result.ok) {
            showMessage('success', '✓ Odesláno! Děkujeme za váš zájem, brzy se vám ozveme.');
            form.reset();
            document.getElementById('source').value = window.location.href;
            setTimeout(() => {
              messagesDiv.innerHTML = '';
            }, 5000);
            return; // Úspěch, ukončíme
          } else {
            throw new Error(result.error || 'Chyba při odesílání');
          }
          
        } catch (fetchError) {
          // Pokud selže kvůli CORS, použijeme no-cors jako fallback
          if (fetchError.message.includes('CORS') || fetchError.message.includes('Failed to fetch')) {
            console.log('CORS error detected, using no-cors fallback');
            useNoCors = true;
          } else {
            throw fetchError; // Jiná chyba, propagujeme ji
          }
        }
        
        // Fallback: použijeme no-cors s JSON stringem
        if (useNoCors) {
          console.log('Using no-cors mode with JSON body');
          await fetch(CONFIG.SCRIPT_ENDPOINT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
              'Content-Type': 'application/json',
            },
            body: jsonData
          });
          
          // S no-cors nemůžeme číst odpověď, předpokládáme úspěch
          showMessage('success', '✓ Odesláno! Děkujeme za váš zájem, brzy se vám ozveme.');
          form.reset();
          document.getElementById('source').value = window.location.href;
          setTimeout(() => {
            messagesDiv.innerHTML = '';
          }, 5000);
        }

      } catch (error) {
        console.error('Error details:', error);
        console.error('Error message:', error.message);
        console.error('Error stack:', error.stack);
        
        // Zobrazíme detailnější chybovou hlášku
        const errorMsg = error.message || 'Neznámá chyba';
        showMessage('error', '❌ Chyba při odesílání: ' + errorMsg + '. Zkuste to prosím znovu později nebo nás kontaktujte přímo na info@freedomfashion.cz');
      } finally {
        // Re-enable button
        isSubmitting = false;
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });

    // Real-time validation
    document.getElementById('email').addEventListener('blur', function() {
      const email = this.value.trim();
      if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        showError('email', 'Zadejte platnou e-mailovou adresu');
      } else {
        showError('email', '');
      }
    });

    // Clear contact error when email or phone is filled
    document.getElementById('email').addEventListener('input', function() {
      if (this.value.trim() || document.getElementById('phone').value.trim()) {
        showError('contact', '');
      }
    });

    document.getElementById('phone').addEventListener('input', function() {
      if (this.value.trim() || document.getElementById('email').value.trim()) {
        showError('contact', '');
      }
    });
  </script>
</body>
</html>
